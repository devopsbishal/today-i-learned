# EKS Storage - The Locker & Storage Room System

> Understanding persistent storage in EKS using PV, PVC, StorageClass, EBS, and EFS - continuing the office campus analogy.

---

## TL;DR

| EKS Storage Concept | Office Campus Analogy |
|---------------------|----------------------|
| PersistentVolume (PV) | Actual locker or room assigned to you |
| PersistentVolumeClaim (PVC) | Request form: "I need a locker with X capacity" |
| StorageClass | Category in facilities catalog (basic locker, fireproof safe, shared room) |
| Static Provisioning | Facilities has empty lockers ready, assigns on request |
| Dynamic Provisioning | Facilities orders & installs new locker when you request |
| CSI Driver | Facilities team (installs lockers, cuts keys, moves lockers) |
| EBS Volume | Personal locker (one key, one worker - but locker can move) |
| EFS | Shared team room (multiple keys, whole team enters together) |
| ReadWriteOnce (RWO) | Personal locker - only you have the key |
| ReadWriteMany (RWX) | Shared room - everyone has a copy of the key |
| Volume mounting | Getting your key and accessing your locker/room |

---

## The Problem: Workers Need Persistent Storage

Workers (pods) are temporary - they come and go. But their documents need to survive!

```
WITHOUT PERSISTENT STORAGE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   Worker starts â†’ Creates documents â†’ Worker leaves         â”‚
â”‚                                              â†“              â”‚
â”‚                                      Documents GONE! âŒ     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WITH PERSISTENT STORAGE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   Worker starts â†’ Stores in locker â†’ Worker leaves          â”‚
â”‚                                              â†“              â”‚
â”‚                              Documents SAFE in locker! âœ…   â”‚
â”‚                                              â†“              â”‚
â”‚                              New worker â†’ Same locker â†’ Documents!
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## The Building Blocks

### PersistentVolume (PV) - The Actual Locker

A PV is the **actual storage** - like a physical locker in the building.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STORAGE ROOM                             â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚ Locker  â”‚  â”‚ Locker  â”‚  â”‚ Locker  â”‚  â”‚ Locker  â”‚      â”‚
â”‚   â”‚   #1    â”‚  â”‚   #2    â”‚  â”‚   #3    â”‚  â”‚   #4    â”‚      â”‚
â”‚   â”‚  10GB   â”‚  â”‚  20GB   â”‚  â”‚  50GB   â”‚  â”‚  100GB  â”‚      â”‚
â”‚   â”‚ (free)  â”‚  â”‚ (used)  â”‚  â”‚ (free)  â”‚  â”‚ (used)  â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                             â”‚
â”‚   Each locker = PersistentVolume                           â”‚
â”‚   Has specific size & type                                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### PersistentVolumeClaim (PVC) - The Request Form

A PVC is a **request** for storage - like filling out a form asking facilities for a locker.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                STORAGE REQUEST FORM (PVC)                   â”‚
â”‚                                                             â”‚
â”‚   Employee: payment-service                                 â”‚
â”‚   Department: production                                    â”‚
â”‚                                                             â”‚
â”‚   Requirements:                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ â–¡ Locker type: fireproof (StorageClass: gp3)       â”‚  â”‚
â”‚   â”‚ â–¡ Size needed: 10GB                                 â”‚  â”‚
â”‚   â”‚ â–¡ Access: Just me (ReadWriteOnce)                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚   Signature: ____________                                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```yaml
# PVC in Kubernetes
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: payment-storage
  namespace: production
spec:
  storageClassName: gp3           # Locker type
  accessModes:
    - ReadWriteOnce               # Just me
  resources:
    requests:
      storage: 10Gi               # Size needed
```

---

### How PV and PVC Work Together

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  SEPARATION OF CONCERNS                                     â”‚
â”‚                                                             â”‚
â”‚  Platform Team (Admin)         Developer                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ "I manage the     â”‚        â”‚ "I just need      â”‚        â”‚
â”‚  â”‚  storage backend" â”‚        â”‚  10GB storage"    â”‚        â”‚
â”‚  â”‚                   â”‚        â”‚                   â”‚        â”‚
â”‚  â”‚  Creates PVs or   â”‚        â”‚  Creates PVC      â”‚        â”‚
â”‚  â”‚  StorageClasses   â”‚        â”‚  with requirementsâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚            â”‚                            â”‚                   â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                       â–¼                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚   KUBERNETES    â”‚                           â”‚
â”‚              â”‚                 â”‚                           â”‚
â”‚              â”‚ Matches PVC to  â”‚                           â”‚
â”‚              â”‚ suitable PV     â”‚                           â”‚
â”‚              â”‚                 â”‚                           â”‚
â”‚              â”‚ Status: Bound âœ…â”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                             â”‚
â”‚  Developer doesn't care HOW storage is provided!           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### StorageClass - The Facilities Catalog

StorageClass defines **types of storage** available - like a catalog of locker options.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FACILITIES STORAGE CATALOG                 â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ OPTION 1: Basic Locker (gp2)                        â”‚   â”‚
â”‚  â”‚ â€¢ Standard metal locker                             â”‚   â”‚
â”‚  â”‚ â€¢ Good for general documents                        â”‚   â”‚
â”‚  â”‚ â€¢ Cost: $                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ OPTION 2: Premium Locker (gp3)                      â”‚   â”‚
â”‚  â”‚ â€¢ Faster access, better performance                 â”‚   â”‚
â”‚  â”‚ â€¢ Good for frequently accessed documents            â”‚   â”‚
â”‚  â”‚ â€¢ Cost: $$                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ OPTION 3: High-Security Safe (io2)                  â”‚   â”‚
â”‚  â”‚ â€¢ Ultra-fast access, maximum performance            â”‚   â”‚
â”‚  â”‚ â€¢ For critical, high-access documents               â”‚   â”‚
â”‚  â”‚ â€¢ Cost: $$$                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ OPTION 4: Shared Team Room (efs)                    â”‚   â”‚
â”‚  â”‚ â€¢ Multiple workers can access together              â”‚   â”‚
â”‚  â”‚ â€¢ For shared team documents                         â”‚   â”‚
â”‚  â”‚ â€¢ Cost: $$                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```yaml
# StorageClass in Kubernetes
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: gp3
provisioner: ebs.csi.aws.com    # Who installs lockers
parameters:
  type: gp3                      # AWS EBS type
  encrypted: "true"              # Locked with encryption
reclaimPolicy: Delete            # What happens when PVC deleted
volumeBindingMode: WaitForFirstConsumer
```

---

## Static vs Dynamic Provisioning

### Static Provisioning - Pre-Built Lockers

Facilities has **empty lockers ready** and assigns when requested.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  1. Admin pre-creates lockers (PVs)                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚     â”‚ Locker  â”‚  â”‚ Locker  â”‚  â”‚ Locker  â”‚                 â”‚
â”‚     â”‚  10GB   â”‚  â”‚  20GB   â”‚  â”‚  50GB   â”‚                 â”‚
â”‚     â”‚ (empty) â”‚  â”‚ (empty) â”‚  â”‚ (empty) â”‚                 â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                             â”‚
â”‚  2. Developer requests 10GB (PVC)                          â”‚
â”‚                                                             â”‚
â”‚  3. K8s matches to existing 10GB locker                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚     â”‚ Locker  â”‚ â† Assigned!                                â”‚
â”‚     â”‚  10GB   â”‚                                            â”‚
â”‚     â”‚ (used)  â”‚                                            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                             â”‚
â”‚  Manual work: Admin must pre-create PVs                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Dynamic Provisioning - On-Demand Lockers

Facilities **orders and installs new locker** when you request.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  1. Developer creates PVC                                  â”‚
â”‚     "I need a gp3 locker, 10GB"                           â”‚
â”‚                        â”‚                                    â”‚
â”‚                        â–¼                                    â”‚
â”‚  2. StorageClass sees request                              â”‚
â”‚     "gp3 class = I'll order from EBS supplier"            â”‚
â”‚                        â”‚                                    â”‚
â”‚                        â–¼                                    â”‚
â”‚  3. CSI Driver (facilities team):                          â”‚
â”‚     â€¢ Orders locker from AWS (CreateVolume)                â”‚
â”‚     â€¢ Installs it in the building                          â”‚
â”‚     â€¢ Creates PV automatically                             â”‚
â”‚                        â”‚                                    â”‚
â”‚                        â–¼                                    â”‚
â”‚  4. PVC bound to new PV                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚     â”‚ Locker  â”‚ â† Brand new, just for you!                 â”‚
â”‚     â”‚  10GB   â”‚                                            â”‚
â”‚     â”‚ (bound) â”‚                                            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                             â”‚
â”‚  Automatic! No admin work needed!                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## CSI Driver - The Facilities Team

**CSI = Container Storage Interface** - A standard for how Kubernetes talks to storage systems.

The CSI Driver is like the **facilities management team** that handles all storage operations.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EBS CSI DRIVER                             â”‚
â”‚                   (Facilities Team)                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           CSI CONTROLLER                                â”‚   â”‚
â”‚  â”‚           (Facilities Manager)                          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â€¢ Watches for new storage requests (PVCs)             â”‚   â”‚
â”‚  â”‚  â€¢ Orders lockers from AWS (CreateVolume API)          â”‚   â”‚
â”‚  â”‚  â€¢ Creates PV records in Kubernetes                    â”‚   â”‚
â”‚  â”‚  â€¢ Handles locker disposal when not needed             â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           CSI NODE PLUGIN                               â”‚   â”‚
â”‚  â”‚           (Facilities Worker - on every node)           â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â€¢ Installs locker outside your room (AttachVolume)    â”‚   â”‚
â”‚  â”‚  â€¢ Cuts the key (formats filesystem)                   â”‚   â”‚
â”‚  â”‚  â€¢ Gives you access (mounts into pod)                  â”‚   â”‚
â”‚  â”‚  â€¢ Removes locker when you leave (DetachVolume)        â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## The Complete Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  1. Developer creates PVC                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ kind: PersistentVolumeClaim           â”‚                  â”‚
â”‚     â”‚ spec:                                 â”‚                  â”‚
â”‚     â”‚   storageClassName: gp3               â”‚                  â”‚
â”‚     â”‚   resources:                          â”‚                  â”‚
â”‚     â”‚     requests:                         â”‚                  â”‚
â”‚     â”‚       storage: 10Gi                   â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â–¼                                        â”‚
â”‚  2. CSI Controller sees PVC                                    â”‚
â”‚     "gp3 StorageClass uses ebs.csi.aws.com provisioner"       â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â–¼                                        â”‚
â”‚  3. CSI Controller calls AWS API                               â”‚
â”‚     CreateVolume(size=10GB, type=gp3, encrypted=true)         â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â–¼                                        â”‚
â”‚  4. AWS creates EBS volume: vol-abc123                         â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â–¼                                        â”‚
â”‚  5. CSI Controller creates PV in Kubernetes                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ kind: PersistentVolume                â”‚                  â”‚
â”‚     â”‚ spec:                                 â”‚                  â”‚
â”‚     â”‚   capacity: 10Gi                      â”‚                  â”‚
â”‚     â”‚   csi:                                â”‚                  â”‚
â”‚     â”‚     driver: ebs.csi.aws.com           â”‚                  â”‚
â”‚     â”‚     volumeHandle: vol-abc123          â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â–¼                                        â”‚
â”‚  6. Kubernetes binds PVC to PV                                 â”‚
â”‚     PVC Status: Bound âœ…                                       â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â–¼                                        â”‚
â”‚  7. Pod created with PVC                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ volumes:                              â”‚                  â”‚
â”‚     â”‚   - name: data                        â”‚                  â”‚
â”‚     â”‚     persistentVolumeClaim:            â”‚                  â”‚
â”‚     â”‚       claimName: my-pvc               â”‚                  â”‚
â”‚     â”‚ containers:                           â”‚                  â”‚
â”‚     â”‚   - volumeMounts:                     â”‚                  â”‚
â”‚     â”‚       - mountPath: /data              â”‚                  â”‚
â”‚     â”‚         name: data                    â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â–¼                                        â”‚
â”‚  8. CSI Node Plugin on scheduled node:                         â”‚
â”‚     â€¢ Attaches vol-abc123 to EC2 instance                     â”‚
â”‚     â€¢ Formats filesystem (ext4)                                â”‚
â”‚     â€¢ Mounts to /var/lib/kubelet/pods/.../volumes/...         â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â–¼                                        â”‚
â”‚  9. Pod can read/write to /data! ğŸ‰                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## EBS vs EFS: Personal Locker vs Shared Room

### EBS - Personal Locker (ReadWriteOnce)

EBS is like a **personal locker** - only one key, follows you when you move.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EBS BEHAVIOR                           â”‚
â”‚                                                             â”‚
â”‚  Day 1: Worker in Room A (Node A)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Room A (Node A)                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚ Worker      â”‚â”€â”€â”€â–¶â”‚   Locker    â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚ (Pod)       â”‚    â”‚   (EBS)     â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  10GB data  â”‚                 â”‚  â”‚
â”‚  â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  Day 2: Worker moves to Room B (Node B)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Room B (Node B)                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚ Worker      â”‚â”€â”€â”€â–¶â”‚   Locker    â”‚ â† Same locker!  â”‚  â”‚
â”‚  â”‚  â”‚ (Pod)       â”‚    â”‚   (EBS)     â”‚   Moved here!   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  10GB data  â”‚                 â”‚  â”‚
â”‚  â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  âœ… Data survives pod restarts and moves!                  â”‚
â”‚  âŒ Only ONE worker can use it at a time                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CANNOT do this with EBS:**

```
âŒ MULTIPLE WORKERS, DIFFERENT ROOMS:

Room A              Room B              Room C
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Worker 1    â”‚    â”‚ Worker 2    â”‚    â”‚ Worker 3    â”‚
â”‚ writing...  â”‚    â”‚ writing...  â”‚    â”‚ writing...  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Locker   â”‚
                    â”‚   (EBS)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EBS = Block storage = Can only attach to ONE node at a time!
```

---

### EFS - Shared Team Room (ReadWriteMany)

EFS is like a **shared team room** - everyone has a key, access from anywhere.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EFS BEHAVIOR                           â”‚
â”‚                                                             â”‚
â”‚  Room A (Node A)    Room B (Node B)    Room C (Node C)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Worker 1    â”‚   â”‚ Worker 2    â”‚   â”‚ Worker 3    â”‚      â”‚
â”‚  â”‚ reading/    â”‚   â”‚ reading/    â”‚   â”‚ reading/    â”‚      â”‚
â”‚  â”‚ writing     â”‚   â”‚ writing     â”‚   â”‚ writing     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                 â”‚                 â”‚              â”‚
â”‚         â”‚           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”           â”‚              â”‚
â”‚         â”‚           â”‚           â”‚           â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  SHARED   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                     â”‚   ROOM    â”‚                          â”‚
â”‚                     â”‚   (EFS)   â”‚                          â”‚
â”‚                     â”‚           â”‚                          â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                             â”‚
â”‚  âœ… Multiple workers from different rooms                  â”‚
â”‚  âœ… All see the same files                                 â”‚
â”‚  âœ… All can read AND write simultaneously                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Access Modes Explained

| Access Mode | Abbreviation | EBS | EFS | Meaning |
|-------------|--------------|-----|-----|---------|
| **ReadWriteOnce** | RWO | âœ… | âœ… | One node can mount read-write |
| **ReadOnlyMany** | ROX | âœ…* | âœ… | Many nodes can mount read-only |
| **ReadWriteMany** | RWX | âŒ | âœ… | Many nodes can mount read-write |

*EBS ROX requires io2 with Multi-Attach feature

---

## EBS vs EFS Comparison

| Aspect | EBS (Personal Locker) | EFS (Shared Room) |
|--------|----------------------|-------------------|
| **Access Mode** | ReadWriteOnce | ReadWriteMany |
| **Multiple pods** | Same node only | Any node âœ… |
| **Performance** | Higher (3,000 baseline, up to 16,000 IOPS) | Lower (network FS) |
| **Latency** | Lower (block storage) | Higher (NFS protocol) |
| **Cost** | $0.08/GB/month (gp3) | $0.30/GB/month |
| **Use case** | Databases, single pod | Shared files, multi-pod |
| **AZ bound** | Yes (single AZ) | No (multi-AZ) |

---

## When to Use What

### Use EBS For:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EBS USE CASES                            â”‚
â”‚                                                             â”‚
â”‚  âœ… Databases (PostgreSQL, MySQL, MongoDB)                 â”‚
â”‚     â””â”€ Single pod, high IOPS needed                        â”‚
â”‚                                                             â”‚
â”‚  âœ… Elasticsearch / Kafka / Redis                          â”‚
â”‚     â””â”€ Each instance needs dedicated fast storage          â”‚
â”‚                                                             â”‚
â”‚  âœ… Jenkins master                                         â”‚
â”‚     â””â”€ Single pod, persistent workspace                    â”‚
â”‚                                                             â”‚
â”‚  âœ… Any single-pod stateful application                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Use EFS For:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EFS USE CASES                            â”‚
â”‚                                                             â”‚
â”‚  âœ… WordPress / CMS (shared media uploads)                 â”‚
â”‚     â””â”€ Multiple frontend pods share /wp-content/uploads    â”‚
â”‚                                                             â”‚
â”‚  âœ… Shared configuration files                             â”‚
â”‚     â””â”€ All pods read same config                           â”‚
â”‚                                                             â”‚
â”‚  âœ… ML model storage                                       â”‚
â”‚     â””â”€ Multiple inference pods read same model             â”‚
â”‚                                                             â”‚
â”‚  âœ… Shared logs / reports                                  â”‚
â”‚     â””â”€ Multiple pods write to shared location              â”‚
â”‚                                                             â”‚
â”‚  âœ… Static website assets                                  â”‚
â”‚     â””â”€ Multiple web servers serve same files               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Decision Flowchart

```
Need persistent storage for pods?
â”‚
â”œâ”€â”€ How many pods need access simultaneously?
â”‚   â”‚
â”‚   â”œâ”€â”€ ONE pod at a time
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Need high performance?
â”‚   â”‚       â”œâ”€â”€ YES â†’ EBS gp3 or io2
â”‚   â”‚       â””â”€â”€ NO  â†’ EBS gp3
â”‚   â”‚
â”‚   â””â”€â”€ MULTIPLE pods simultaneously
â”‚       â”‚
â”‚       â””â”€â”€ EFS âœ…
â”‚           (Only option for ReadWriteMany)

Quick Rule:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Single pod, high performance â†’ EBS                        â”‚
â”‚  Multiple pods, shared access â†’ EFS                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Real-World Example: WordPress

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WORDPRESS DEPLOYMENT                         â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                   DATABASE TIER                         â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â”‚   StatefulSet: mysql (1 replica)                       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚  â”‚
â”‚   â”‚   â”‚   MySQL     â”‚â”€â”€â”€â–¶ EBS gp3 20GB                     â”‚  â”‚
â”‚   â”‚   â”‚    Pod      â”‚     (ReadWriteOnce)                  â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     High IOPS for DB writes         â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                   WEB TIER                              â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â”‚   Deployment: wordpress (3 replicas)                   â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â”‚   Node A          Node B          Node C               â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚   â”‚   â”‚WordPressâ”‚    â”‚WordPressâ”‚    â”‚WordPressâ”‚           â”‚  â”‚
â”‚   â”‚   â”‚  Pod 1  â”‚    â”‚  Pod 2  â”‚    â”‚  Pod 3  â”‚           â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚   â”‚        â”‚              â”‚              â”‚                 â”‚  â”‚
â”‚   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚   â”‚                       â”‚                                 â”‚  â”‚
â”‚   â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚  â”‚
â”‚   â”‚                  â”‚  EFS   â”‚ â† /wp-content/uploads      â”‚  â”‚
â”‚   â”‚                  â”‚ 50GB   â”‚   (ReadWriteMany)          â”‚  â”‚
â”‚   â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   All pods see uploads     â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Installing CSI Drivers in EKS

### EBS CSI Driver

```bash
# Install via EKS add-on (recommended)
aws eks create-addon \
  --cluster-name my-cluster \
  --addon-name aws-ebs-csi-driver \
  --service-account-role-arn arn:aws:iam::123:role/EBS-CSI-Role

# Or via Helm
helm install aws-ebs-csi-driver aws-ebs-csi-driver/aws-ebs-csi-driver \
  --namespace kube-system
```

### EFS CSI Driver

```bash
# Install via EKS add-on (recommended)
aws eks create-addon \
  --cluster-name my-cluster \
  --addon-name aws-efs-csi-driver \
  --service-account-role-arn arn:aws:iam::123:role/EFS-CSI-Role

# Or via Helm
helm install aws-efs-csi-driver aws-efs-csi-driver/aws-efs-csi-driver \
  --namespace kube-system
```

**Note:** CSI drivers need IAM permissions (use IRSA or Pod Identity!)

---

## Key Takeaways

1. **PV = actual storage, PVC = request for storage** - Separation of concerns
2. **StorageClass enables dynamic provisioning** - No manual PV creation
3. **CSI Driver = facilities team** - Handles all storage operations
4. **EBS = personal locker (RWO)** - One pod at a time, high performance
5. **EFS = shared room (RWX)** - Multiple pods, any node
6. **EBS is faster but single-pod** - Use for databases
7. **EFS is shared but slower** - Use for shared files

---

## Related Reading

- [AWS VPC - The Compound Analogy](../november/2025-11-30-aws-vpc.md)
- [AWS EKS - The Managed Office Building Analogy](./2025-12-02-aws-eks.md)
- [AWS VPC CNI - The Phone Extension System](./2025-12-03-aws-vpc-cni.md)
- [EKS Networking - The Mail & Delivery System](./2025-12-09-eks-networking.md)
- [EKS IAM - The Employee Badge System](./2025-12-10-eks-iam-irsa-pod-identity.md)

---

*Written on December 11, 2025*
